{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\nimport { CosmosDiagnosticContext } from \"./CosmosDiagnosticsContext\";\nimport { CosmosDiagnostics, getRootNode } from \"../CosmosDiagnostics\";\nimport { getCurrentTimestampInMs } from \"../utils/time\";\nimport { CosmosDbDiagnosticLevel } from \"./CosmosDbDiagnosticLevel\";\nimport { Constants, prepareURL } from \"../common\";\nimport { allowTracing } from \"./diagnosticLevelComparator\";\nimport { randomUUID } from \"@azure/core-util\";\n/**\n * @hidden\n * This is Internal Representation for DiagnosticNode. It contains useful helper functions to collect\n * diagnostic information throughout the lifetime of Diagnostic session.\n * The functions toDiagnosticNode() & toDiagnostic() are given to convert it to public facing counterpart.\n */\nexport class DiagnosticNodeInternal {\n  /**\n   * @internal\n   */\n  constructor(diagnosticLevel, type, parent, data = {}, startTimeUTCInMs = getCurrentTimestampInMs(), ctx = new CosmosDiagnosticContext()) {\n    this.id = randomUUID();\n    this.nodeType = type;\n    this.startTimeUTCInMs = startTimeUTCInMs;\n    this.data = data;\n    this.children = [];\n    this.durationInMs = 0;\n    this.parent = parent;\n    this.diagnosticCtx = ctx;\n    this.diagnosticLevel = diagnosticLevel;\n  }\n  /**\n   * @internal\n   */\n  addLog(msg) {\n    if (!this.data.log) {\n      this.data.log = [];\n    }\n    this.data.log.push(msg);\n  }\n  /**\n   * @internal\n   */\n  sanitizeHeaders(headers) {\n    return headers;\n  }\n  /**\n   * Updated durationInMs for node, based on endTimeUTCInMs provided.\n   * @internal\n   */\n  updateTimestamp(endTimeUTCInMs = getCurrentTimestampInMs()) {\n    this.durationInMs = endTimeUTCInMs - this.startTimeUTCInMs;\n  }\n  /**\n   * @internal\n   */\n  recordSuccessfulNetworkCall(startTimeUTCInMs, requestContext, pipelineResponse, substatus, url) {\n    const responseHeaders = pipelineResponse.headers.toJSON();\n    const gatewayRequest = {\n      activityId: responseHeaders[Constants.HttpHeaders.ActivityId],\n      correlateActivityId: requestContext.headers[Constants.HttpHeaders.CorrelatedActivityId],\n      startTimeUTCInMs,\n      durationInMs: getCurrentTimestampInMs() - startTimeUTCInMs,\n      statusCode: pipelineResponse.status,\n      subStatusCode: substatus,\n      requestPayloadLengthInBytes: calculateRequestPayloadLength(requestContext),\n      responsePayloadLengthInBytes: calculateResponsePayloadLength(pipelineResponse),\n      operationType: requestContext.operationType,\n      resourceType: requestContext.resourceType,\n      partitionKeyRangeId: requestContext.partitionKeyRangeId\n    };\n    let requestData = {\n      OperationType: gatewayRequest.operationType,\n      resourceType: gatewayRequest.resourceType,\n      requestPayloadLengthInBytes: gatewayRequest.requestPayloadLengthInBytes\n    };\n    if (allowTracing(CosmosDbDiagnosticLevel.debugUnsafe, this.diagnosticLevel)) {\n      requestData = Object.assign(Object.assign({}, requestData), {\n        headers: this.sanitizeHeaders(requestContext.headers),\n        requestBody: requestContext.body,\n        responseBody: pipelineResponse.bodyAsText,\n        url: url\n      });\n    }\n    this.addData({\n      requestPayloadLengthInBytes: gatewayRequest.requestPayloadLengthInBytes,\n      responsePayloadLengthInBytes: gatewayRequest.responsePayloadLengthInBytes,\n      startTimeUTCInMs: gatewayRequest.startTimeUTCInMs,\n      durationInMs: gatewayRequest.durationInMs,\n      requestData\n    });\n    this.diagnosticCtx.recordNetworkCall(gatewayRequest);\n  }\n  /**\n   * @internal\n   */\n  recordFailedNetworkCall(startTimeUTCInMs, requestContext, retryAttemptNumber, statusCode, substatusCode, responseHeaders) {\n    this.addData({\n      failedAttempty: true\n    });\n    const requestPayloadLengthInBytes = calculateRequestPayloadLength(requestContext);\n    this.diagnosticCtx.recordFailedAttempt({\n      activityId: responseHeaders[Constants.HttpHeaders.ActivityId],\n      correlatedActivityId: requestContext.headers[Constants.HttpHeaders.CorrelatedActivityId],\n      startTimeUTCInMs,\n      durationInMs: getCurrentTimestampInMs() - startTimeUTCInMs,\n      statusCode,\n      subStatusCode: substatusCode,\n      requestPayloadLengthInBytes,\n      responsePayloadLengthInBytes: 0,\n      operationType: requestContext.operationType,\n      resourceType: requestContext.resourceType\n    }, retryAttemptNumber);\n    let requestData = {\n      OperationType: requestContext.operationType,\n      resourceType: requestContext.resourceType,\n      requestPayloadLengthInBytes\n    };\n    if (allowTracing(CosmosDbDiagnosticLevel.debugUnsafe, this.diagnosticLevel)) {\n      requestData = Object.assign(Object.assign({}, requestData), {\n        headers: this.sanitizeHeaders(requestContext.headers),\n        requestBody: requestContext.body,\n        url: prepareURL(requestContext.endpoint, requestContext.path)\n      });\n    }\n    this.addData({\n      failedAttempty: true,\n      requestData\n    });\n  }\n  /**\n   * @internal\n   */\n  recordEndpointResolution(location) {\n    this.addData({\n      selectedLocation: location\n    });\n    this.diagnosticCtx.recordEndpointResolution(location);\n  }\n  /**\n   * @internal\n   */\n  addData(data, msg, level = this.diagnosticLevel) {\n    if (level !== CosmosDbDiagnosticLevel.info) {\n      this.data = Object.assign(Object.assign({}, this.data), data);\n      if (msg) {\n        this.addLog(msg);\n      }\n    }\n  }\n  /**\n   * Merge given DiagnosticNodeInternal's context to current node's DiagnosticContext, Treating GatewayRequests of\n   * given DiagnosticContext, as metadata requests. Given DiagnosticNodeInternal becomes a child of this node.\n   * @internal\n   */\n  addChildNode(child, level, metadataType) {\n    this.diagnosticCtx.mergeDiagnostics(child.diagnosticCtx, metadataType);\n    if (allowTracing(level, this.diagnosticLevel)) {\n      child.parent = this;\n      this.children.push(child);\n    }\n    return child;\n  }\n  /**\n   * @internal\n   */\n  initializeChildNode(type, level, data = {}) {\n    if (allowTracing(level, this.diagnosticLevel)) {\n      const child = new DiagnosticNodeInternal(this.diagnosticLevel, type, this, data, getCurrentTimestampInMs(), this.diagnosticCtx);\n      this.children.push(child);\n      return child;\n    } else {\n      return this;\n    }\n  }\n  /**\n   * @internal\n   */\n  recordQueryResult(resources, level) {\n    var _a;\n    if (allowTracing(level, this.diagnosticLevel)) {\n      const previousCount = (_a = this.data.queryRecordsRead) !== null && _a !== void 0 ? _a : 0;\n      if (Array.isArray(resources)) {\n        this.data.queryRecordsRead = previousCount + resources.length;\n      }\n    }\n  }\n  /**\n   * Convert DiagnosticNodeInternal (internal representation) to DiagnosticNode (public, sanitized representation)\n   * @internal\n   */\n  toDiagnosticNode() {\n    return {\n      id: this.id,\n      nodeType: this.nodeType,\n      children: this.children.map(child => child.toDiagnosticNode()),\n      data: this.data,\n      startTimeUTCInMs: this.startTimeUTCInMs,\n      durationInMs: this.durationInMs\n    };\n  }\n  /**\n   * Convert to CosmosDiagnostics\n   * @internal\n   */\n  toDiagnostic(clientConfigDiagnostic) {\n    const rootNode = getRootNode(this);\n    const diagnostiNode = allowTracing(CosmosDbDiagnosticLevel.debug, this.diagnosticLevel) ? rootNode.toDiagnosticNode() : undefined;\n    const clientConfig = allowTracing(CosmosDbDiagnosticLevel.debug, this.diagnosticLevel) ? clientConfigDiagnostic : undefined;\n    const cosmosDiagnostic = new CosmosDiagnostics(this.diagnosticCtx.getClientSideStats(), diagnostiNode, clientConfig);\n    return cosmosDiagnostic;\n  }\n}\n/**\n * @hidden\n */\nexport var DiagnosticNodeType;\n(function (DiagnosticNodeType) {\n  DiagnosticNodeType[\"CLIENT_REQUEST_NODE\"] = \"CLIENT_REQUEST_NODE\";\n  DiagnosticNodeType[\"METADATA_REQUEST_NODE\"] = \"METADATA_REQUEST_NODE\";\n  DiagnosticNodeType[\"HTTP_REQUEST\"] = \"HTTP_REQUEST\";\n  DiagnosticNodeType[\"BATCH_REQUEST\"] = \"BATCH_REQUEST\";\n  DiagnosticNodeType[\"PARALLEL_QUERY_NODE\"] = \"PARALLEL_QUERY_NODE\";\n  DiagnosticNodeType[\"DEFAULT_QUERY_NODE\"] = \"DEFAULT_QUERY_NODE\";\n  DiagnosticNodeType[\"QUERY_REPAIR_NODE\"] = \"QUERY_REPAIR_NODE\";\n  DiagnosticNodeType[\"BACKGROUND_REFRESH_THREAD\"] = \"BACKGROUND_REFRESH_THREAD\";\n  DiagnosticNodeType[\"REQUEST_ATTEMPTS\"] = \"REQUEST_ATTEMPTS\";\n})(DiagnosticNodeType || (DiagnosticNodeType = {}));\nfunction calculateResponsePayloadLength(response) {\n  var _a;\n  return ((_a = response === null || response === void 0 ? void 0 : response.bodyAsText) === null || _a === void 0 ? void 0 : _a.length) || 0;\n}\nfunction calculateRequestPayloadLength(requestContext) {\n  return requestContext.body ? requestContext.body.length : 0;\n}","map":{"version":3,"names":["CosmosDiagnosticContext","CosmosDiagnostics","getRootNode","getCurrentTimestampInMs","CosmosDbDiagnosticLevel","Constants","prepareURL","allowTracing","randomUUID","DiagnosticNodeInternal","constructor","diagnosticLevel","type","parent","data","startTimeUTCInMs","ctx","id","nodeType","children","durationInMs","diagnosticCtx","addLog","msg","log","push","sanitizeHeaders","headers","updateTimestamp","endTimeUTCInMs","recordSuccessfulNetworkCall","requestContext","pipelineResponse","substatus","url","responseHeaders","toJSON","gatewayRequest","activityId","HttpHeaders","ActivityId","correlateActivityId","CorrelatedActivityId","statusCode","status","subStatusCode","requestPayloadLengthInBytes","calculateRequestPayloadLength","responsePayloadLengthInBytes","calculateResponsePayloadLength","operationType","resourceType","partitionKeyRangeId","requestData","OperationType","debugUnsafe","Object","assign","requestBody","body","responseBody","bodyAsText","addData","recordNetworkCall","recordFailedNetworkCall","retryAttemptNumber","substatusCode","failedAttempty","recordFailedAttempt","correlatedActivityId","endpoint","path","recordEndpointResolution","location","selectedLocation","level","info","addChildNode","child","metadataType","mergeDiagnostics","initializeChildNode","recordQueryResult","resources","previousCount","_a","queryRecordsRead","Array","isArray","length","toDiagnosticNode","map","toDiagnostic","clientConfigDiagnostic","rootNode","diagnostiNode","debug","undefined","clientConfig","cosmosDiagnostic","getClientSideStats","DiagnosticNodeType","response"],"sources":["/Users/ajitpawar/microsoft/bap/POCs/Scenario_checker_for_maker/mcs-scenario-checker-for-maker/node_modules/@azure/cosmos/src/diagnostics/DiagnosticNodeInternal.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { CosmosDiagnosticContext } from \"./CosmosDiagnosticsContext\";\nimport type { RequestContext } from \"../request\";\nimport type {\n  DiagnosticNode,\n  MetadataLookUpType,\n  ClientConfigDiagnostic,\n} from \"../CosmosDiagnostics\";\nimport { CosmosDiagnostics, getRootNode } from \"../CosmosDiagnostics\";\nimport { getCurrentTimestampInMs } from \"../utils/time\";\nimport { CosmosDbDiagnosticLevel } from \"./CosmosDbDiagnosticLevel\";\nimport type { CosmosHeaders } from \"../queryExecutionContext/CosmosHeaders\";\nimport type { HttpHeaders, PipelineResponse } from \"@azure/core-rest-pipeline\";\nimport type { OperationType, ResourceType } from \"../common\";\nimport { Constants, prepareURL } from \"../common\";\nimport { allowTracing } from \"./diagnosticLevelComparator\";\nimport { randomUUID } from \"@azure/core-util\";\n\n/**\n * @hidden\n * This is Internal Representation for DiagnosticNode. It contains useful helper functions to collect\n * diagnostic information throughout the lifetime of Diagnostic session.\n * The functions toDiagnosticNode() & toDiagnostic() are given to convert it to public facing counterpart.\n */\nexport class DiagnosticNodeInternal implements DiagnosticNode {\n  public id: string;\n  public nodeType: DiagnosticNodeType;\n  public parent: DiagnosticNodeInternal;\n  public children: DiagnosticNodeInternal[];\n  public data: Partial<DiagnosticDataValue>;\n  public startTimeUTCInMs: number;\n  public durationInMs: number;\n  public diagnosticLevel: CosmosDbDiagnosticLevel;\n  private diagnosticCtx: CosmosDiagnosticContext;\n\n  /**\n   * @internal\n   */\n  constructor(\n    diagnosticLevel: CosmosDbDiagnosticLevel,\n    type: DiagnosticNodeType,\n    parent: DiagnosticNodeInternal,\n    data: Partial<DiagnosticDataValue> = {},\n    startTimeUTCInMs: number = getCurrentTimestampInMs(),\n    ctx: CosmosDiagnosticContext = new CosmosDiagnosticContext(),\n  ) {\n    this.id = randomUUID();\n    this.nodeType = type;\n    this.startTimeUTCInMs = startTimeUTCInMs;\n    this.data = data;\n    this.children = [];\n    this.durationInMs = 0;\n    this.parent = parent;\n    this.diagnosticCtx = ctx;\n    this.diagnosticLevel = diagnosticLevel;\n  }\n\n  /**\n   * @internal\n   */\n  private addLog(msg: string): void {\n    if (!this.data.log) {\n      this.data.log = [];\n    }\n    this.data.log.push(msg);\n  }\n\n  /**\n   * @internal\n   */\n  private sanitizeHeaders(headers?: CosmosHeaders | HttpHeaders): CosmosHeaders | HttpHeaders {\n    return headers;\n  }\n\n  /**\n   * Updated durationInMs for node, based on endTimeUTCInMs provided.\n   * @internal\n   */\n  public updateTimestamp(endTimeUTCInMs: number = getCurrentTimestampInMs()): void {\n    this.durationInMs = endTimeUTCInMs - this.startTimeUTCInMs;\n  }\n\n  /**\n   * @internal\n   */\n  public recordSuccessfulNetworkCall(\n    startTimeUTCInMs: number,\n    requestContext: RequestContext,\n    pipelineResponse: PipelineResponse,\n    substatus: number,\n    url: string,\n  ): void {\n    const responseHeaders = pipelineResponse.headers.toJSON();\n    const gatewayRequest = {\n      activityId: responseHeaders[Constants.HttpHeaders.ActivityId],\n      correlateActivityId: requestContext.headers[Constants.HttpHeaders.CorrelatedActivityId],\n      startTimeUTCInMs,\n      durationInMs: getCurrentTimestampInMs() - startTimeUTCInMs,\n      statusCode: pipelineResponse.status,\n      subStatusCode: substatus,\n      requestPayloadLengthInBytes: calculateRequestPayloadLength(requestContext),\n      responsePayloadLengthInBytes: calculateResponsePayloadLength(pipelineResponse),\n      operationType: requestContext.operationType,\n      resourceType: requestContext.resourceType,\n      partitionKeyRangeId: requestContext.partitionKeyRangeId,\n    };\n    let requestData: any = {\n      OperationType: gatewayRequest.operationType,\n      resourceType: gatewayRequest.resourceType,\n      requestPayloadLengthInBytes: gatewayRequest.requestPayloadLengthInBytes,\n    };\n\n    if (allowTracing(CosmosDbDiagnosticLevel.debugUnsafe, this.diagnosticLevel)) {\n      requestData = {\n        ...requestData,\n        headers: this.sanitizeHeaders(requestContext.headers),\n        requestBody: requestContext.body,\n        responseBody: pipelineResponse.bodyAsText,\n        url: url,\n      };\n    }\n    this.addData({\n      requestPayloadLengthInBytes: gatewayRequest.requestPayloadLengthInBytes,\n      responsePayloadLengthInBytes: gatewayRequest.responsePayloadLengthInBytes,\n      startTimeUTCInMs: gatewayRequest.startTimeUTCInMs,\n      durationInMs: gatewayRequest.durationInMs,\n      requestData,\n    });\n    this.diagnosticCtx.recordNetworkCall(gatewayRequest);\n  }\n\n  /**\n   * @internal\n   */\n  public recordFailedNetworkCall(\n    startTimeUTCInMs: number,\n    requestContext: RequestContext,\n    retryAttemptNumber: number,\n    statusCode: number,\n    substatusCode: number,\n    responseHeaders: CosmosHeaders,\n  ): void {\n    this.addData({ failedAttempty: true });\n    const requestPayloadLengthInBytes = calculateRequestPayloadLength(requestContext);\n    this.diagnosticCtx.recordFailedAttempt(\n      {\n        activityId: responseHeaders[Constants.HttpHeaders.ActivityId] as string,\n        correlatedActivityId: requestContext.headers[\n          Constants.HttpHeaders.CorrelatedActivityId\n        ] as string,\n        startTimeUTCInMs,\n        durationInMs: getCurrentTimestampInMs() - startTimeUTCInMs,\n        statusCode,\n        subStatusCode: substatusCode,\n        requestPayloadLengthInBytes,\n        responsePayloadLengthInBytes: 0,\n        operationType: requestContext.operationType,\n        resourceType: requestContext.resourceType,\n      },\n      retryAttemptNumber,\n    );\n    let requestData: any = {\n      OperationType: requestContext.operationType,\n      resourceType: requestContext.resourceType,\n      requestPayloadLengthInBytes,\n    };\n    if (allowTracing(CosmosDbDiagnosticLevel.debugUnsafe, this.diagnosticLevel)) {\n      requestData = {\n        ...requestData,\n        headers: this.sanitizeHeaders(requestContext.headers),\n        requestBody: requestContext.body,\n        url: prepareURL(requestContext.endpoint, requestContext.path),\n      };\n    }\n    this.addData({\n      failedAttempty: true,\n      requestData,\n    });\n  }\n\n  /**\n   * @internal\n   */\n  public recordEndpointResolution(location: string): void {\n    this.addData({ selectedLocation: location });\n    this.diagnosticCtx.recordEndpointResolution(location);\n  }\n\n  /**\n   * @internal\n   */\n  public addData(\n    data: Partial<DiagnosticDataValue>,\n    msg?: string,\n    level: CosmosDbDiagnosticLevel = this.diagnosticLevel,\n  ): void {\n    if (level !== CosmosDbDiagnosticLevel.info) {\n      this.data = { ...this.data, ...data };\n      if (msg) {\n        this.addLog(msg);\n      }\n    }\n  }\n\n  /**\n   * Merge given DiagnosticNodeInternal's context to current node's DiagnosticContext, Treating GatewayRequests of\n   * given DiagnosticContext, as metadata requests. Given DiagnosticNodeInternal becomes a child of this node.\n   * @internal\n   */\n  public addChildNode(\n    child: DiagnosticNodeInternal,\n    level: CosmosDbDiagnosticLevel,\n    metadataType?: MetadataLookUpType,\n  ): DiagnosticNodeInternal {\n    this.diagnosticCtx.mergeDiagnostics(child.diagnosticCtx, metadataType);\n    if (allowTracing(level, this.diagnosticLevel)) {\n      child.parent = this;\n      this.children.push(child);\n    }\n    return child;\n  }\n\n  /**\n   * @internal\n   */\n  public initializeChildNode(\n    type: DiagnosticNodeType,\n    level: CosmosDbDiagnosticLevel,\n    data: Partial<DiagnosticDataValue> = {},\n  ): DiagnosticNodeInternal {\n    if (allowTracing(level, this.diagnosticLevel)) {\n      const child = new DiagnosticNodeInternal(\n        this.diagnosticLevel,\n        type,\n        this,\n        data,\n        getCurrentTimestampInMs(),\n        this.diagnosticCtx,\n      );\n      this.children.push(child);\n      return child;\n    } else {\n      return this;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  public recordQueryResult(resources: unknown, level: CosmosDbDiagnosticLevel): void {\n    if (allowTracing(level, this.diagnosticLevel)) {\n      const previousCount = this.data.queryRecordsRead ?? 0;\n      if (Array.isArray(resources)) {\n        this.data.queryRecordsRead = previousCount + resources.length;\n      }\n    }\n  }\n\n  /**\n   * Convert DiagnosticNodeInternal (internal representation) to DiagnosticNode (public, sanitized representation)\n   * @internal\n   */\n  public toDiagnosticNode(): DiagnosticNode {\n    return {\n      id: this.id,\n      nodeType: this.nodeType,\n      children: this.children.map((child) => child.toDiagnosticNode()),\n      data: this.data,\n      startTimeUTCInMs: this.startTimeUTCInMs,\n      durationInMs: this.durationInMs,\n    };\n  }\n\n  /**\n   * Convert to CosmosDiagnostics\n   * @internal\n   */\n  public toDiagnostic(clientConfigDiagnostic: ClientConfigDiagnostic): CosmosDiagnostics {\n    const rootNode = getRootNode(this);\n    const diagnostiNode = allowTracing(CosmosDbDiagnosticLevel.debug, this.diagnosticLevel)\n      ? rootNode.toDiagnosticNode()\n      : undefined;\n    const clientConfig = allowTracing(CosmosDbDiagnosticLevel.debug, this.diagnosticLevel)\n      ? clientConfigDiagnostic\n      : undefined;\n    const cosmosDiagnostic = new CosmosDiagnostics(\n      this.diagnosticCtx.getClientSideStats(),\n      diagnostiNode,\n      clientConfig,\n    );\n    return cosmosDiagnostic;\n  }\n}\n\n/**\n * @hidden\n */\nexport type DiagnosticDataValue = {\n  selectedLocation: string;\n  activityId: string;\n  requestAttempNumber: number;\n  requestPayloadLengthInBytes: number;\n  responsePayloadLengthInBytes: number;\n  responseStatus: number;\n  readFromCache: boolean;\n  operationType: OperationType;\n  metadatOperationType: MetadataLookUpType;\n  resourceType: ResourceType;\n  failedAttempty: boolean;\n  successfulRetryPolicy: string;\n  partitionKeyRangeId: string;\n  stateful: boolean;\n  queryRecordsRead: number;\n  queryMethodIdentifier: string;\n  log: string[];\n  failure: boolean;\n  startTimeUTCInMs: number;\n  durationInMs: number;\n  requestData: Partial<{\n    requestPayloadLengthInBytes: number;\n    responsePayloadLengthInBytes: number;\n    operationType: OperationType;\n    resourceType: ResourceType;\n    headers: CosmosHeaders;\n    requestBody: any;\n    responseBody: any;\n    url: string;\n  }>;\n};\n\n/**\n * @hidden\n */\nexport enum DiagnosticNodeType {\n  CLIENT_REQUEST_NODE = \"CLIENT_REQUEST_NODE\", // Top most node representing client operations.\n  METADATA_REQUEST_NODE = \"METADATA_REQUEST_NODE\", // Node representing a metadata request.\n  HTTP_REQUEST = \"HTTP_REQUEST\", // Node representing REST call to backend services.\n  BATCH_REQUEST = \"BATCH_REQUEST\", // Node representing batch request.\n  PARALLEL_QUERY_NODE = \"PARALLEL_QUERY_NODE\", // Node representing parallel query execution.\n  DEFAULT_QUERY_NODE = \"DEFAULT_QUERY_NODE\", // Node representing default query execution.\n  QUERY_REPAIR_NODE = \"QUERY_REPAIR_NODE\", // Node representing query repair.\n  BACKGROUND_REFRESH_THREAD = \"BACKGROUND_REFRESH_THREAD\", // Node representing background refresh.\n  REQUEST_ATTEMPTS = \"REQUEST_ATTEMPTS\", // Node representing request attempts.\n}\n\nfunction calculateResponsePayloadLength(response: PipelineResponse) {\n  return response?.bodyAsText?.length || 0;\n}\n\nfunction calculateRequestPayloadLength(requestContext: RequestContext) {\n  return requestContext.body ? requestContext.body.length : 0;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}